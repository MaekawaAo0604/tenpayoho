name: Generate Tweet Content with Claude

on:
  schedule:
    # æ¯æ—¥åˆå‰7æ™‚(JST)ã«å®Ÿè¡Œ (UTC 22:00 = JST 07:00)
    - cron: '0 22 * * *'
  workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

permissions:
  issues: write
  contents: read

jobs:
  create-issue:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Get current date (JST)
        id: date
        run: |
          echo "today=$(TZ=Asia/Tokyo date +'%Yå¹´%mæœˆ%dæ—¥ (%a)')" >> $GITHUB_OUTPUT
          echo "date_short=$(TZ=Asia/Tokyo date +'%-m/%-d(%a)')" >> $GITHUB_OUTPUT

      - name: Create issue with tweet request
        uses: actions/github-script@v7
        id: create-issue
        with:
          script: |
            const issue = await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `ğŸ“ å¤©ãƒ‘äºˆå ±ãƒ„ã‚¤ãƒ¼ãƒˆç”Ÿæˆä¾é ¼ - ${{ steps.date.outputs.today }}`,
              body: `@claude

ã“ã‚“ã«ã¡ã¯ï¼ä»Šæ—¥ã®å¤©ãƒ‘äºˆå ±ã®ãƒ„ã‚¤ãƒ¼ãƒˆæ–‡ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

## ğŸ“‹ ä¾é ¼å†…å®¹

ä»¥ä¸‹ã®è¦ä»¶ã«å¾“ã£ã¦ã€å¤©ãƒ‘äºˆå ±botç”¨ã®ãƒ„ã‚¤ãƒ¼ãƒˆæ–‡ã‚’ä½œæˆã—ã¦ãã ã•ã„:

### âœ… è¦ä»¶
- **æ–‡å­—æ•°**: 140æ–‡å­—ä»¥å†…
- **ãƒˆãƒ¼ãƒ³**: æ˜ã‚‹ãè¦ªã—ã¿ã‚„ã™ã„ã€å¤©ãƒ‘ã«æ‚©ã‚€äººã«å¯„ã‚Šæ·»ã†æ¸©ã‹ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- **æ—¥ä»˜**: ${{ steps.date.outputs.date_short }}
- **å†…å®¹**:
  - æŒ¨æ‹¶ã¨æ—¥ä»˜ã‚’å«ã‚ã‚‹
  - å…¨å›½ã®å¤©ãƒ‘æŒ‡æ•°ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‚ˆã†ä¿ƒã™
  - éƒ½å¸‚åã‚„å…·ä½“çš„ãªæ•°å€¤ã¯ä¸è¦ï¼ˆç”»åƒã§è¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚ï¼‰
  - å¿…é ˆãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°: #å¤©ãƒ‘äºˆå ± #æ—¥æœ¬å¤©ãƒ‘å”ä¼š #ãã›æ¯›
  - çµµæ–‡å­—ã‚’é©åº¦ã«ä½¿ç”¨ï¼ˆä½¿ã„ã™ããªã„ï¼‰

### ğŸ“ å‡ºåŠ›å½¢å¼
\`\`\`
ãƒ„ã‚¤ãƒ¼ãƒˆæ–‡ã‚’ã“ã“ã«è¨˜è¼‰
\`\`\`

---
**æ³¨æ„**: ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯å†…ã«ãƒ„ã‚¤ãƒ¼ãƒˆæ–‡ã®ã¿ã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚èª¬æ˜ã‚„å‰ç½®ãã¯ä¸è¦ã§ã™ã€‚

ç”ŸæˆãŒå®Œäº†ã—ãŸã‚‰ã€ã“ã®Issueã«ã‚³ãƒ¡ãƒ³ãƒˆã§å›ç­”ã—ã¦ãã ã•ã„ã€‚`,
              labels: ['tweet-generation', 'automated']
            });

            console.log(\`Created issue #\${issue.data.number}\`);
            return issue.data.number;

      - name: Wait for Claude response
        run: |
          echo "âœ… Issue created successfully!"
          echo "Issue URL: ${{ github.server_url }}/${{ github.repository }}/issues/${{ steps.create-issue.outputs.result }}"
          echo ""
          echo "ğŸ¤– Claude will respond to the issue shortly."
          echo "ğŸ“Œ Check the issue to get the generated tweet content."
